$(function(){function FormSubmit(e){if(e.preventDefault(),0==$("#old_client_id").val())return!0;var id=$("input[name=invoice_id]").val(),form=$("#detailsform").serializeObject();form.id=id,form.action="changething",$.post(cmdUrl,form,function(data){var resp=parse_response(data);resp&&($("#detcont").html(resp),$.post(cmdUrl,{id:id,action:"updatetotals"},function(data){var resp=parse_response(data);if(resp&&resp.length>10){var $resp=$(resp);$("#updatetotals").html($resp.filter("#updatetotals").html()),$("#main-invoice").html($resp.filter("#main-invoice").html())}}))})}function ItemsSubmit(){var line=$(this).parent().parent(),lineid=$(line).attr("id").replace("line_",""),id=$("input[name=invoice_id]").val(),total=(parseFloat($(line).find(".invqty").eq(0).val())*parseFloat(line.find(".invamount").eq(0).val())).toFixed(2),form=$("#itemsform").serializeObject();line.find("#ltotal_"+lineid).html(total),form.action="updatetotals",form.id=id,$("#main-invoice").addLoader(),$.post(cmdUrl,form,function(data){var resp=parse_response(data);if(resp&&resp.length>10){var $resp=$(resp);$("#updatetotals").html($resp.filter("#updatetotals").html()),$("#main-invoice").html($resp.filter("#main-invoice").html())}RefreshDetails()})}function RefreshDetails(){var id=$("input[name=invoice_id]").val();$.post(cmdUrl,{action:"getdetailsmenu",id:id},function(data){var resp=parse_response(data);resp&&resp.length>10&&$("#detcont").html(resp)})}var cmdUrl=window.location.href.replace(/(id|action)=[^&]*&?/g,"").replace(/&$|&#/,"");$("#bodycont").on("click","#addclientcredit",function(){var id=$("input[name=invoice_id]").val(),form=$("#detailsform").serializeObject();return form.id=id,form.action="applycredit",$.post(cmdUrl,form,function(data){parse_response(data);RefreshDetails()}),!1}),$("#bodycont").on("mouseenter",".editline",function(){$(this).hasClass("editable1")||$(this).find(".editbtn").show()}),$("#bodycont").on("mouseleave",".editline",function(){$(this).find(".editbtn").hide()}),$("#bodycont").on("click",".editline .editbtn",function(){var p=$(this).parent();return p.find("textarea").height(p.find(".line_descr").height()),p.addClass("editable1").children().hide(),p.find(".editor-line").show().find("textarea").focus(),!1}),$("#bodycont").on("click",".editline .savebtn",function(){var l=$(this).parent().parent();return l.find(".line_descr").html(l.find("textarea").val().replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br/>$2")).show(),l.removeClass("editable1").find(".editor-line").hide(),l.parent().find(".invitem").eq(0).change(),!1}),$("#bodycont").on("click",".removeLine",function(){$(this);$(this).parent().parent().addClass("yellow_bg");var answer=confirm("Do you really want to delete this line?");return answer&&($("#main-invoice").addLoader(),$.post($(this).attr("href"),{empty1mc:"param"},function(data){var resp=parse_response(data);$("#main-invoice").html(resp),$(".invitem").eq(0).change()})),$(this).parent().parent().removeClass("yellow_bg"),!1}),$("#bodycont").on("change",".invitem",ItemsSubmit),$("#bodycont").on("click",".invitem2",ItemsSubmit),$("#bodycont").on("submit","#detailsform",FormSubmit)});